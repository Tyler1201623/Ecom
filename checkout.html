<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Checkout</title>
    <link rel="stylesheet" href="checkout.css">
</head>
<body>
    <div class="checkout-container">
        <h1>Checkout</h1>
        <form id="checkoutForm">
            <label for="fullName">Full Name:</label>
            <input type="text" id="fullName" name="fullName" required>
            <span class="error-message" id="fullNameError"></span>

            <label for="address">Address:</label>
            <input type="text" id="address" name="address" required>
            <span class="error-message" id="addressError"></span>

            <label for="city">City:</label>
            <input type="text" id="city" name="city" required>
            <span class="error-message" id="cityError"></span>

            <label for="state">State:</label>
            <input type="text" id="state" name="state" required>
            <span class="error-message" id="stateError"></span>

            <label for="zip">ZIP Code:</label>
            <input type="text" id="zip" name="zip" required>
            <span class="error-message" id="zipError"></span>

            <label for="country">Country:</label>
            <input type="text" id="country" name="country" required>
            <span class="error-message" id="countryError"></span>

            <label for="cardNumber">Card Number:</label>
            <input type="text" id="cardNumber" name="cardNumber" required>
            <span class="error-message" id="cardNumberError"></span>

            <label for="expiryDate">Expiry Date:</label>
            <input type="text" id="expiryDate" name="expiryDate" placeholder="MM/YY" required>
            <span class="error-message" id="expiryDateError"></span>

            <label for="cvv">CVV:</label>
            <input type="text" id="cvv" name="cvv" required>
            <span class="error-message" id="cvvError"></span>

            <label for="email">Email:</label>
            <input type="email" id="email" name="email" required>
            <span class="error-message" id="emailError"></span>

            <button type="submit">Place Order</button>
        </form>
    </div>

    <div class="notification" id="notification"></div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const checkoutForm = document.getElementById('checkoutForm');

            checkoutForm.addEventListener('submit', async (event) => {
                event.preventDefault();

                // Clear previous error messages
                const errorMessages = document.querySelectorAll('.error-message');
                errorMessages.forEach(msg => msg.textContent = '');

                // Gather form data
                const formData = new FormData(checkoutForm);
                const data = {};
                formData.forEach((value, key) => data[key] = value);

                try {
                    const response = await fetch('/api/checkout', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify(data)
                    });

                    const result = await response.json();
                    if (response.ok) {
                        showNotification('Order placed successfully!', 'success');
                        checkoutForm.reset();
                        localStorage.removeItem('cart'); // Clear cart after successful order
                    } else {
                        if (result.errors) {
                            result.errors.forEach(error => {
                                document.getElementById(`${error.param}Error`).textContent = error.msg;
                            });
                        } else {
                            showNotification(result.message, 'error');
                        }
                    }
                } catch (error) {
                    showNotification('An error occurred while placing your order. Please try again.', 'error');
                }
            });

            function showNotification(message, type) {
                const notification = document.getElementById('notification');
                notification.textContent = message;
                notification.className = `notification ${type}`;
                notification.classList.add('show');
                setTimeout(() => {
                    notification.classList.remove('show');
                }, 3000);
            }
        });
    </script>
</body>
</html>
